<!DOCTYPE html>
<html>
<title>Meowton</title>
<head>
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
</head>
<script>

    //global progress indication
    progress_count=0;
    function progress_start()
    {
        progress_count++;
        document.querySelectorAll('.global-progress').forEach(e => e.style.visibility='visible');
    }

    function progress_done()
    {
        progress_count--;
        if (progress_count<=0)
        {
            progress_count=0;
            document.querySelectorAll('.global-progress').forEach(e => e.style.visibility='hidden');
        }
    }
    
    ons.ready(function(){
        progress_done();
    });

    //call a python function via our simple rpc interface
    function rpc(cmd, load_handler) {

        progress_start();
        var req = new XMLHttpRequest();

        // oReq.addEventListener("progress", updateProgress);
        req.addEventListener("load", function (event) {
            progress_done();
            if (req.status == 200) {
                console.debug("rpc result 200", req);
                if (load_handler) {
                    result = JSON.parse(req.response);
                    load_handler(result);
                }
            }
            else {
                console.error("rpc result NON 200", req);
                ons.notification.toast('Error: ' + req.responseText, { timeout: 2000 });

            }

        });

        req.addEventListener("error", function (event) {
            progress_done();
            console.error("rpc error", req)
            ons.notification.toast('Error during action.', { timeout: 2000 });
        });

        // oReq.addEventListener("abort", transferCanceled);

        req.open('GET', "/rpc/" + cmd);
        req.send();

        return (req);

    }

    function menu_rpc(cmd) {
        document.querySelector('#menu').close();
        rpc(cmd);
    }

    const loadPage = (page) => {
        document.querySelector('#menu').close();
        document.querySelector('#navigator').bringPageTop(page);
    };




</script>



<body>



    <ons-splitter>
        <!-- The side menu -->
        <ons-splitter-side id="menu" collapse>
            <ons-page>
                <ons-list>
                    <ons-list-item onclick="loadPage('cats.html')">
                        My cats
                    </ons-list-item>
                    <ons-list-item>
                        <ons-button onclick="menu_rpc('scale_cat.recalibrate')">Calibrate scale</ons-button>
                    </ons-list-item>
                    <ons-list-item>
                        <ons-button onclick="menu_rpc('scale_cat.tarre')">Tarre scale</ons-button>
                    </ons-list-item>
                    <ons-list-item>
                        <ons-button onclick="menu_rpc('scale_food.recalibrate')">Calibrate food</ons-button>
                    </ons-list-item>
                    <ons-list-item>
                        <ons-button onclick="menu_rpc('scale_food.tarre')">Tarre food</ons-button>
                    </ons-list-item>
                    <ons-list-item onclick="loadPage('hardware.html')">
                        Hardware settings
                    </ons-list-item>
                    <ons-list-item onclick="loadPage('about.html')">
                        About
                    </ons-list-item>

                </ons-list>
            </ons-page>
        </ons-splitter-side>

        <!-- Everything not in the side menu -->
        <ons-splitter-content>

            <ons-navigator id="navigator" page="home.html"></ons-navigator>
        </ons-splitter-content>
    </ons-splitter>

    <ons-modal direction="up" id='reconnecting'>
        <div style="text-align: center">
            <p>
                <ons-icon icon="md-spinner" size="28px" spin></ons-icon>Connecting...
            </p>
        </div>
    </ons-modal>

</body>



</html>