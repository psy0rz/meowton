<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
</head>
<script>
    const loadPage = (page) => {
        document.querySelector('#menu').close();
        document.querySelector('#navigator').bringPageTop(page);
    };

    //listen to events from esp
    var source = new EventSource("/events");
    source.onmessage = function (event) {

        document.querySelector('#reconnecting').hide();

        console.log(event.data);
        data=JSON.parse(event.data);
        // console.log(data);

        document.querySelector('#msg').textContent = data.msg;

        document.querySelector('#cat-weight').textContent = data.scale_weight;
        if (data.scale_weight_unstable === true)
            document.querySelector("#cat-weight-unstable").style.display = "";
        else
            document.querySelector("#cat-weight-unstable").style.display = "none";

        document.querySelector('#food-weight').textContent = data.food_weight;
        if (data.food_weight_unstable === true)
            document.querySelector("#food-weight-unstable").style.display = "";
        else
            document.querySelector("#food-weight-unstable").style.display = "none";
    }
    source.onerror = function (error) {
        console.log(error);
        document.querySelector('#reconnecting').show();
        // document.getElementById("result").innerHTML += "EventSource error:" + error + "<br>";
    }

</script>



<body>



    <ons-splitter>
        <!-- The side menu -->
        <ons-splitter-side id="menu" collapse>
            <ons-page>
                <ons-list>
                    <ons-list-item>
                        <ons-button onclick="calibrate">Calibrate scale</ons-button>
                    </ons-list-item>
                    <ons-list-item onclick="loadPage('about.html')">
                        About
                    </ons-list-item>

                </ons-list>
            </ons-page>
        </ons-splitter-side>

        <!-- Everything not in the side menu -->
        <ons-splitter-content>
            <ons-navigator id="navigator" page="home.html"></ons-navigator>
        </ons-splitter-content>
    </ons-splitter>

    <ons-modal direction="up" id='reconnecting'>
        <div style="text-align: center">
            <p>
                <ons-icon icon="md-spinner" size="28px" spin></ons-icon>Reconnecting...
            </p>
        </div>
    </ons-modal>

</body>



</html>