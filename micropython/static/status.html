<ons-page id="status">
    <script>
        //listen to events from esp
        var source = new EventSource("/events");
        source.onmessage = function (event) {

            document.querySelector('#reconnecting').hide();

            console.debug(event.data);
            data = JSON.parse(event.data);
            // console.log(data);

            //scale stuff
            document.querySelector('#msg').textContent = data.msg;
            document.querySelector('#scale-weight').textContent = data.scale_weight.toFixed(0)+"g";
            document.querySelector('#food-weight').textContent = data.food_weight.toFixed(1)+"g";

            if (data.scale_weight_unstable === true)
                document.querySelector("#scale-weight-unstable").style.visibility = "visible";
            else
                document.querySelector("#scale-weight-unstable").style.visibility = "hidden";

            if (data.food_weight_unstable === true)
                document.querySelector("#food-weight-unstable").style.visibility = "visible";
            else
                document.querySelector("#food-weight-unstable").style.visibility = "hidden";

            //cat info
            document.querySelector('#cat-name').textContent = data.cat.name;
            document.querySelector('#cat-weight').textContent = data.cat.weight.toFixed(0)+"g";
            document.querySelector('#cat-state').textContent = data.cat_state;
            document.querySelector('#cat-ate-session').textContent = data.cat.ate_session;

        }
        source.onerror = function (error) {
            console.log(error);
            document.querySelector('#reconnecting').show();
            // document.getElementById("result").innerHTML += "EventSource error:" + error + "<br>";
        }

    </script>

    <ons-list>
        <ons-list-header>Actual status</ons-list-header>

        <ons-list-item>
            <div id="msg" style='font-weight: bold;'>
                Loading...
            </div>
        </ons-list-item>

        <ons-list-item>
            <div class="left">
                Cat scale
            </div>
            <div class="center">
                <ons-icon icon="spinner" spin class="list-item__icon" id='scale-weight-unstable'></ons-icon>
            </div>
            <div class="right" id='scale-weight'>
                ...
            </div>

        </ons-list-item>

        <ons-list-item>
            <div class="left">
                Food scale
            </div>
            <div class="center">
                <ons-icon icon="spinner" spin class="list-item__icon" id='food-weight-unstable'></ons-icon>
            </div>
            <div class="right" id='food-weight'>
                ...
            </div>
        </ons-list-item>


        <ons-list-header>Last cat</ons-list-header>

        <ons-list-item>
            <div class="center">
                Status
            </div>
            <div class="right" id='cat-state'>
                Gone
            </div>
        </ons-list-item>

        <ons-list-item>
            <div class="center">
                Name
            </div>
            <div class="right" id='cat-name'>
                ...
            </div>
        </ons-list-item>

        <ons-list-item>
            <div class="center">
                Average weight
            </div>
            <div class="right" id='cat-weight'>
                ...
            </div>
        </ons-list-item>

        <ons-list-item>
            <div class="center">
                Ate
            </div>
            <div class="right" id='cat-ate-session'>
                ...
            </div>
        </ons-list-item>


    </ons-list>



</ons-page>